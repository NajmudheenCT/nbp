<?xml version="1.0" encoding="utf-8"?>
<project name="ngc" basedir="" default="main">
    <property name="root" value="../"/>
     <property name="ngc.dir" value="../../ngc_register/ngcplugin"/>
    <property name="esdk.dir" value="${ngc.dir}/esdk"/>
    <property environment="env"/>
    <property name="VSPHERE_SDK_HOME" value="${env.VSPHERE_SDK_HOME}"/>
    <property name="platform.selfDev" value="${root}/lib"/>

    <target name="init">
        <echo message="init, mkdir"/>
        <mkdir dir="${ngc.dir}"/>
        <mkdir dir="${esdk.dir}"/>
        <mkdir dir="${esdk.dir}\plugins"/>
    </target>

    <target name="build-java" depends="init">
        <echo message="build「NGCPlugin-service」！"/>
        <ant dir="..\service" antfile="build-java.xml"/>
    </target>
    <target name="build-resources" depends="build-java">
        <echo message="build「NGCPlugin-html_build-resources」！"/>
        <ant dir="..\html" antfile="build-resources.xml"/>
    </target>

    <target name="build-war" depends="build-java">
        <echo message="build「NGCPlugin-html_build-war」！"/>
        <ant dir="..\html" antfile="build-war.xml"/>
    </target>

    <target name="copy" depends="build-war">
        <echo message="copy！"/>
        <copy todir="${esdk.dir}\plugins">
            <fileset dir="..\service\target">
                <include name="ngc.jar"/>
            </fileset>

            <fileset dir="..\html\target">
                <include name="ngc.war"/>
            </fileset>

           <fileset dir="${platform.selfDev}">
                <include name="opensds_common.jar"/>
            </fileset>

            <fileset dir="${VSPHERE_SDK_HOME}\libs">
                <include name="vim25.jar"/>
            </fileset>
        </copy>

        <copy todir="${esdk.dir}">
            <fileset dir="..\config">
                <include name="plugin-package.xml"/>
            </fileset>
        </copy>
    </target>


    <target name="zipesdk" depends="copy">
        <echo message="zip esdk.zip!"/>
        <zip destfile="${ngc.dir}/esdk.zip"
             basedir="${esdk.dir}" includes="**"></zip>
    </target>

    <target name="clean" depends="zipesdk">
        <delete dir="${esdk.dir}"/>
    </target>

    <target name="main" depends="clean">
        <echo message="success to build ngc plugin！"/>
    </target>

</project>